\documentclass{article}

\usepackage{amssymb}
\usepackage{amsthm}
\usepackage[UKenglish]{babel}
\usepackage{enumitem}
\usepackage{fancyhdr}
\usepackage[margin=1in]{geometry}
\usepackage{graphicx}
\usepackage[utf8]{inputenc}
\usepackage{listings}
\usepackage{mathtools}
\usepackage{tikz-cd}
\usepackage{csquotes}

\newcommand{\F}{\mathbb{F}}
\newcommand{\N}{\mathbb{N}}
\newcommand{\Z}{\mathbb{Z}}
\newcommand{\Q}{\mathbb{Q}}
\newcommand{\R}{\mathbb{R}}
\newcommand{\C}{\mathbb{C}}
\newcommand{\A}{\mathbb{A}}
\renewcommand{\P}{\mathbb{P}}

\newcommand{\val}[1]{\left. #1 \right\rvert}
\newcommand{\rb}[1]{\left( #1 \right)}
\renewcommand{\sb}[1]{\left[ #1 \right]}
\newcommand{\cb}[1]{\left\{ #1 \right\}}
\newcommand{\ab}[1]{\left\langle #1 \right\rangle}
\newcommand{\abs}[1]{\left\lvert #1 \right\rvert}
\newcommand{\two}[2]{\begin{pmatrix} #1 \\ #2 \end{pmatrix}}
\newcommand{\three}[3]{\begin{pmatrix} #1 & #2 & #3 \end{pmatrix}}

\newcommand{\legendre}[2]{\rb{\tfrac{#1}{#2}}}

\theoremstyle{definition}\newtheorem{definition}{Definition}
\theoremstyle{definition}\newtheorem*{remark}{Remark}
\theoremstyle{definition}\newtheorem*{example}{Example}
\theoremstyle{definition}\newtheorem*{note}{Note}
\newtheorem{proposition}[definition]{Proposition}
\newtheorem{lemma}[definition]{Lemma}
\newtheorem{theorem}[definition]{Theorem}
\newtheorem{corollary}[definition]{Corollary}

\pagestyle{fancy}
\lhead{M3P14 Number Theory}
\rhead{Autumn 2018}

\title{M3P14 Number Theory}
\author{Lectured by Prof Toby Gee \\ Typeset by David Kurniadi Angdinata}
\date{Autumn 2018}

\setcounter{section}{-1}

\begin{document}

\maketitle

\vfill

\tableofcontents

\pagebreak

\marginpar{Lecture 1 \\ Friday \\ 05/10/18}

\section{Introduction}

Roughly speaking number theory is the study of the integers. More specifically, problems in number theory often have a lot to do with primes and divisibility, congruences, and include problems about the rational numbers. For example, solving equations in integers or in the rationals, such as $ x^2 - 2y^2 = 1 $, etc. We will be looking at problems that can be tackled by elementary means, but this does not mean easy. Also the statements of problems can be elementary without the solution being elementary, such as Fermat's Last Theorem, or even known, such as the twin prime conjecture. Sometimes we will state interesting things, like the prime number theorem, without proving them. Typically these will be things that we could prove if the course was much longer. We will start the course with a look at prime numbers and factorisation, a review of Euclid's algorithm and consequences, congruences, the structure of $ \rb{\Z / n\Z}^* $, RSA algorithm, and quadratic reciprocity. We will return to primes at the end, too. Typical questions here include the following.
\begin{enumerate}
\item How do you tell if a number is prime?
\item How many primes are there congruent to $ a $ modulo $ b $ for given $ a, b $?
\item How many primes are there less than $ n $?
\end{enumerate}
A warning is that we will be using plenty of things from previous algebra courses, about groups, rings, ideals, fields, Lagrange's theorem, the first isomorphism theorem, and so on. You may want to revise this material if you are not comfortable with it. The course is not based on any particular book, although some material, such as continued fractions, was drawn from the following.
\begin{enumerate}
\item A Baker, A concise introduction to the theory of numbers, 1984
\end{enumerate}
Not everything we will do is in that book, though.

\section{Euclidean algorithm and unique factorisation}

\subsection{Divisibility}

\begin{definition}
Let $ a, b \in \Z $. We say that $ a $ \textbf{divides} $ b $, written $ a \mid b $, if there exists $ c \in \Z $ such that $ b = ac $. If $ a $ does not divide $ b $, write $ a \nmid b $.
\end{definition}

\begin{note}
If $ a, b, c \in \Z $ such that $ a \mid b $ and $ a \mid c $, then $ a \mid \rb{rb + sc} $ for any $ r, s \in \Z $.
\end{note}

\begin{definition}
Let $ a, b \in \Z $, not both zero. The \textbf{greatest common divisor} (gcd) or \textbf{highest common factor} (hcf) of $ a $ and $ b $, written $ \rb{a, b} $, is the largest positive integer dividing both $ a $ and $ b $.
\end{definition}

Such an integer always exists since if $ a \ne 0 $ and $ c \mid a $, then $ -a \le c \le a $.

\begin{example}
$ \rb{-10, 15} = 5 $.
\end{example}

\begin{note}
This notation is consistent with notation from ring theory. The ring $ \Z $ is a principal ideal domain (PID), that is it is an integral domain, and every ideal can be generated by one element. The ideal generated by $ f_1, \dots, f_n \in R $ for some ring $ R $ is usually written $ \rb{f_1, \dots, f_n} $, and indeed the ideal $ \rb{a, b} $ is generated by the highest common factor of $ a $ and $ b $, by Theorem \ref{thm:6} below.
\end{note}

\begin{definition}
$ n \in \Z $ is \textbf{prime} if $ n $ has exactly two positive divisors, namely $ 1 $ and $ n $.
\end{definition}

\begin{note}
By definition, primes can be both positive and negative. In spite of this, frequently when people talk about prime numbers they restrict to the positive case. In this course when we say 'Let $ p $ be a prime number' we will generally mean $ p > 0 $. Also $ 1 $ is not prime.
\end{note}

\subsection{Euclid's algorithm}

\begin{proposition}
Let $ a, b \in \Z $, not both zero. Then for any $ n \in \Z $, we have $ \rb{a, b} = \rb{a, b - na} $.
\end{proposition}

\begin{proof}
By definition of $ \rb{a, b} $, it suffices to show that any $ r \in \Z $ divides both $ a $ and $ b $ if and only if it divides both $ a $ and $ b - na $. But if $ r $ divides $ a $ and $ b $, it clearly divides $ b - na $, and if it divides $ a $ and $ b - na $, it clearly divides $ b $.
\end{proof}

This suggests an approach to computing $ \rb{a, b} $ by replacing $ \rb{a, b} $ by a pair $ \rb{a, b - na} $, and repeat until the numbers involved are small enough that it is easy to compute the greatest common divisor. The key to being able to do this is the following innocuous looking result.

\begin{theorem}
\label{thm:5}
Let $ a, b \in \Z $ with $ b > 0 $. Then there exist unique $ q, r \in \Z $ such that $ a = qb + r $ and $ 0 \le r < b $.
\end{theorem}

\begin{proof}
Let $ q = \lfloor a / b \rfloor $ be the largest integer less than $ a / b $. Then by definition $ 0 \le a / b - q < 1 $. Thus $ 0 \le a - qb < b $, so we can take $ r = a - bq $. Uniqueness is easy.
\end{proof}

This gives us \textbf{Euclid's algorithm} for finding $ \rb{a, b} $ for any $ a, b \in \Z $ not both zero. Without loss of generality, assume $ 0 \le b \le a $ and $ a > 0 $.
\begin{enumerate}
\item Check if $ b = 0 $. If so then $ \rb{a, b} = a $.
\item Otherwise, replace $ \rb{a, b} $ with $ \rb{b, r} $ as in Theorem \ref{thm:5}. Then return to step 1.
\end{enumerate}
Since at every stage $ \abs{a} + \abs{b} $ is decreasing, this algorithm terminates. We have shown that $ \rb{a, b} = \rb{b, r} $ so the output is always equal to $ \rb{a, b} $.

\begin{example}
Let us make this explicit.
\begin{align*}
\rb{120, 87}
& = \rb{87, 33} & 120 = 87 + 33 \\
& = \rb{33, 21} & 87 = 2\rb{33} + 21 \\
& = \rb{21, 12} & 33 = 21 + 12 \\
& = \rb{12, 9} & 21 = 12 + 9 \\
& = \rb{9, 3} & 12 = 9 + 3 \\
& = \rb{3, 0} & 9 = 3\rb{3} + 10
\end{align*}
Now run this backwards, writing out the equations.
\begin{align*}
3
& = 12 - 9 \\
& = 12 - \rb{21 - 12} \\
& = 2\rb{12} - 21 \\
& = 2\rb{33 - 21} - 21 \\
& = 2\rb{33} - 3\rb{21} \\
& = 2\rb{33} - 3\rb{87 - 2\rb{33}} \\
& = 8\rb{33} - 3\rb{87} \\
& = 8\rb{120 - 87} - 3\rb{87} \\
& = 8\rb{120} - 11\rb{87}.
\end{align*}
\end{example}

The same works in general, that is the algorithm gives us more than just a way to compute $ \rb{a, b} $. It also allows us to express $ \rb{a, b} $ in terms of $ a $ and $ b $.

\begin{theorem}
\label{thm:6}
Let $ a, b \in \Z $, not both zero. Then there exist $ r, s \in \Z $ such that $ \rb{a, b} = ra + sb $.
\end{theorem}

\begin{proof}
Let $ a_0 = a $ and $ b_0 = b $, and for each $ i $ let $ \rb{a_i, b_i} $ be the result after running $ i $ steps of Euclid's algorithm on the pair $ \rb{a, b} $. For some $ r $ we have $ a_r = \rb{a, b} $ and $ b_r = 0 $. We will show, by downwards induction on $ i $, that there exist $ n_i, m_i \in \Z $ such that $ \rb{a, b} = n_ia_i + m_ib_i $. For $ i = r $ this is clear. On the other hand, for any $ i $ we have $ a_i = b_{i - 1} $ and $ b_i = a_{i - 1} - q_ib_{i - 1} $ for some $ q_i \in \Z $. Thus if $ \rb{a, b} = n_ia_i + m_ib_i $, we have
$$ \rb{a, b} = n_ib_{i - 1} + m_i\rb{a_{i - 1} - q_ib_{i - 1}} = \rb{n_i - m_iq_i}b_{i - 1} + m_ia_{i - 1}, $$
and the claim follows.
\end{proof}

\subsection{Unique factorisation}

The fact that $ \rb{a, b} $ is an integer linear combination of $ a $ and $ b $ has strong consequences for factorisation and divisibility. First note the following.

\begin{proposition}
\label{prop:7}
Let $ n, a, b \in \Z $, and suppose that $ n \mid ab $ and $ \rb{n, a} = 1 $. Then $ n \mid b $.
\end{proposition}

\begin{proof}
Since $ \rb{n, a} = 1 $, there exists $ r, s \in \Z $ such that $ rn + sa = 1 $. Thus $ rnb + sab = b $. But $ n $ clearly divides $ rnb $ and $ sab $, so $ n \mid b $.
\end{proof}

By definition, if $ n $ is prime, then either $ n \mid a $ or $ \rb{n, a} = 1 $. If $ \rb{n, a} = 1 $, we say that $ n, a $ are \textbf{coprime}.

\marginpar{Lecture 2 \\ Tuesday \\ 09/10/18}

\begin{corollary}
\label{cor:8}
If $ p $ is prime, and $ a, b \in \Z $ are such that $ p \mid ab $, then either $ p \mid a $ or $ p \mid b $.
\end{corollary}

\begin{proof}
If $ p \nmid a $ then $ \rb{p, a} = 1 $, so \ref{prop:7} implies $ p \mid b $.
\end{proof}

\begin{proposition}
\label{prop:9}
If $ \rb{a, b} = 1 $, and $ a \mid n $ and $ b \mid n $, then $ ab \mid n $.
\end{proposition}

\begin{proof}
By \ref{thm:6}, we can write $ n = n\rb{a, b} = nra + nsb $ with $ r, s \in \Z $. Each term is divisible by $ ab $, so $ ab \mid n $.
\end{proof}

We say that $ m_1, \dots, m_n \in \Z $ are \textbf{pairwise coprime} if $ \rb{m_i, m_j} = 1 $ for all $ i \ne j $.

\begin{corollary}
\label{cor:10}
Suppose that $ m_1, \dots, m_n $ are pairwise coprime. If $ m_i \mid N $ for all $ i $, then $ m_1 \dots m_n \mid N $.
\end{corollary}

\begin{proof}
Induction on $ n $. $ n = 2 $ is Proposition \ref{prop:9}. (TODO Exercise)
\end{proof}

We can now prove the existence and uniqueness of prime factorisations.

\begin{proposition}
\label{prop:11}
Every $ n \in \Z^* $ can be written as $ \pm p_1 \dots p_r $ for some $ r \ge 0 $ and some primes $ p_1, \dots, p_r $.
\end{proposition}

\begin{proof}
Use induction on $ \abs{n} $. The case $ \abs{n} $ is trivial, so suppose $ \abs{n} > 1 $. Then either $ \abs{n} $ is prime, or $ \abs{n} = ab $ with $ 1 < a, b < \abs{n} $, and by induction each of $ a, b $ is a product of primes.
\end{proof}

\begin{theorem}
Let $ n \in \Z_{> 0} $. Then $ n $ can be written as $ p_1 \dots p_r $ where the $ p_i $ are prime, and are uniquely determined up to reordering.
\end{theorem}

\begin{proof}
Existence is Proposition \ref{prop:11}. For uniqueness, suppose that
$$ n = p_1 \dots p_r = q_1 \dots q_s, $$
with $ p_i, q_i $ prime. Then without loss of generality suppose $ r, s \ge 1 $. Then $ p_1 \mid p_1 \dots p_r $, so $ p_1 \mid q_1 \dots q_s $. By Corollary \ref{cor:8}, either $ p_1 \mid q_1 $ or $ p_1 \mid q_2 \dots q_s $. Proceeding inductively, eventually $ p_1 \mid q_i $ for some $ i $. Since $ q_i $ is prime this means $ p_1 = q_i $. We then have
$$ p_2 \dots p_r = q_1 \dots q_i \dots q_s. $$
Since this product is smaller than $ n $, by the inductive hypothesis we must have $ r - 1 = s - 1 $ and the $ p_i $ except $ p_1 $ are a rearrangement of the $ q_i $ except $ q_i $.
\end{proof}

Put together, these are the fundamental theorem of arithmetic.

\subsection{Linear diophantine equations}

Suppose now that we are given $ a, b, c \in \Z^* $ and we want to solve $ ax + by = c $ for $ x, y \in \Z $. We first note that $ \rb{a, b} $ divides both $ a $ and $ b $, so for there to be any solutions, we must have $ \rb{a, b} \mid c $.

\begin{example}
$ 2x + 6y = 3 $ has no solutions.
\end{example}

From now on, suppose this is true. Let $ a' = a / \rb{a, b} $, $ b' = b / \rb{a, b} $, and $ c' = c / \rb{a, b} $. Then $ ax + by = c $ if and only if $ a'x + b'y = c' $. By Theorem \ref{thm:6}, since $ \rb{a', b'} = 1 $, we can find $ r, s \in \Z $ with $ a'r + b's = 1 $, so $ a'rc' + b'sc' = c' $. So $ x = rc' $, $ y = sc' $ is a solution. $ X, Y $ is another solution if and only if $ a'X + b'Y = a'x + b'y $, if and only if $ a'\rb{X - x} = b'\rb{y - Y} $. For this to hold, we need $ a' \mid \rb{y - Y} $, $ b' \mid \rb{X - x} $. Putting this all together, we find that if $ x, y $ is one solution to $ ax + by = c $, then the other solutions are exactly of the form
$$ X = x + n\dfrac{b}{\rb{a, b}}, \qquad Y = y - n\dfrac{a}{\rb{a, b}} $$
for all $ n \in \Z $.

\begin{example}
Using the example above where we have $ 8\rb{120} - 11\rb{87} = 3 $, we can solve $ 120x + 87y = 9 $. One solution is $ x = 24 $ and $ y = -33 $. The general solution is $ x = 24 + 29n $ and $ y = -33 - 40n $. Taking $ n = -1 $, we have for example, $ x = -5 $ and $ y = 7 $.
\end{example}

\section{Congruences and modular arithmetic}

\subsection{Congruences}

\begin{definition}
Let $ n \in \Z^* $, and let $ a, b \in \Z $. We say $ a $ is \textbf{congruent to $ b $ modulo $ n $}, written $ a \equiv b \mod n $, if $ n \mid \rb{a - b} $.
\end{definition}

For $ n $ fixed, it is easy to verify that congruence modulo $ n $ is an equivalence relation, and therefore partitions $ \Z $ into equivalence classes. The set of equivalence classes modulo $ n $ is denoted $ \Z / n\Z $.

\begin{example}
If $ a \equiv b \mod n $, $ c \equiv d \mod n $, then $ a + c \equiv b + d \mod n $ and $ ac \equiv bd \mod n $.
\end{example}

In fact $ \Z / n\Z $ is a ring, with the obvious addition and multiplication. Indeed $ n\Z = \cb{nr \mid r \in \Z} $ is an ideal in $ \Z $, and $ \Z / n\Z $ is just the quotient ring. For any $ a \in \Z $, we sometimes write $ \overline{a} $ for the image of $ a $ in $ \Z / n\Z $. We can write $ a = qn + r $ with $ 0 \le r < n $. Then $ a \equiv r \mod n $, so $ \overline{a} = \overline{r} $.

\begin{example}
If $ n = 12 $, then $ \overline{25} = \overline{1} $.
\end{example}

It follows that $ 0, \dots, n - 1 $ are representatives for the elements of $ \Z / n\Z $, so every element of $ \Z / n\Z $ is equal to $ \overline{r} $ for some unique $ r \in \cb{0, \dots, n - 1} $. It will also be convenient to write $ \Z / n\Z = \cb{0, \dots, n - 1} $.

\begin{example}
If $ n = 6 $, we could write $ 3 + 4 = 1 $ and $ 3 \times 4 = 0 $.
\end{example}

Recall that if $ R $ is a commutative ring, a \textbf{unit} of $ R $ is an element with a multiplicative inverse, that is $ x $ such that there exists $ y \in R $ with $ xy = 1 $. Write $ R^* $ for the set of units in $ R $. This is a group under multiplication.

\begin{example}
$ \Z^* = \cb{\pm 1} $ and $ \Q^* = \Q \setminus \cb{0} = \cb{x \in \Q \mid x \ne 0} $.
\end{example}

We want to understand $ \rb{\Z / n\Z}^* $. Which elements of $ \cb{0, \dots, n - 1} $ are in $ \rb{\Z / n\Z}^* $? If $ r \in \Z $ and $ \overline{r} \in \rb{\Z / n\Z}^* $ then there exists $ s \in \Z $ such that $ rs \equiv 1 \mod n $. This implies that $ \rb{r, n} = 1 $. Conversely, if $ \rb{r, n} = 1 $, then there exists $ x, y \in \Z $ such that $ rx + ny = 1 $, so $ \overline{rx} = 1 $, so $ \overline{r} $ is a unit. Thus we have $ \rb{\Z / n\Z}^* = \cb{\overline{i} \mid \rb{i, n} = 1} $.

\begin{note}
If $ p $ is a prime, then either $ a \equiv 0 \mod p $ or $ \rb{a, p} = 1 $, so $ \rb{\Z / p\Z}^* = \cb{1, \dots, p - 1} $. Thus every non-zero congruence class modulo $ p $ is a unit, that is $ \Z / p\Z $ is a ring with the property that every non-zero element has a multiplicative inverse, so it is a field. Another equivalent way to see this is to check that $ p\Z $ is a maximal ideal of $ \Z $.
\end{note}

\marginpar{Lecture 3 \\ Wednesday \\ 10/10/18}

\subsection{Linear congruence equations}

Fix $ a, b \in \Z $ and $ c \in \Z^* $. Suppose we want to solve $ ax \equiv b \mod c $. This is equivalent to finding $ x, y $ such that $ ax + cy = b $. In particular, by our analysis of linear diophantine equations, there is a solution precisely when $ \rb{a, c} \mid b $. Furthermore, there is a unique solution modulo $ c' = c / \rb{a, c} $, because all the solutions are obtained by adding multiples of $ c' $ to our given $ x $, and subtracting the corresponding multiple of $ a / \rb{a, c} $ from $ y $. This implies that there are a total of $ \rb{a, c} $ solutions to the original congruence modulo $ c $. If $ x $ is a solution, the other solutions are of the form $ X = x + c'j $ for $ 0 \le j < \rb{a, c} $. In particular, if $ \rb{a, c} = 1 $, then there is a unique solution to $ ax \equiv b \mod c $. Indeed $ a \in \rb{\Z / c\Z}^* $, so it has an inverse $ a^{-1} $, and $ x \equiv a^{-1}b \mod c $ is the unique solution.

\begin{example}
$ 2x \equiv 3 \mod 6 $ has no solutions as $ \rb{2, 6} = 2 \nmid 3 $. $ 2x \equiv 4 \mod 6 $, which is equivalent to $ x \equiv 2 \mod 3 $, has solutions $ x \equiv 2 \mod 6 $ and $ x \equiv 5 \mod 6 $.
\end{example}

\subsection{Chinese remainder theorem}

\begin{theorem}[Chinese remainder theorem]
Let $ m_1, \dots, m_n \in \Z_{\ge 0} $ be pairwise coprime. Then the natural map
$$ \Z / m_1 \dots m_n\Z \to \Z / m_1\Z \times \dots \times \Z / m_n\Z $$
is an isomorphism of rings, and the induced map
$$ \rb{\Z / m_1 \dots m_n\Z}^* \to \rb{\Z / m_1\Z}^* \times \dots \times \rb{\Z / m_n\Z}^* $$
is an isomorphism of abelian groups.
\end{theorem}

\begin{remark}
This is false without the assumption that $ m_i $ pairwise coprime, for example $ m_1 = m_2 = 2 $.
\end{remark}

\begin{proof}
Note firstly that the map exists and is a ring homomorphism. This follows from the fact that if $ x \equiv y \mod m_1 \dots m_n $ then certainly $ x \equiv y \mod m_i $ for each $ i $. The source and target of the ring homomorphism both have order $ m_1 \dots m_n $, so it suffices to show that the map is injective to show that it is an isomorphism. So we only need to check that the kernel is zero. So we need to know that if $ m_i \mid N $ for all $ i $, that is $ \overline{N} = 0 $ in $ \Z / m_i\Z $, then $ m_1 \dots m_n \mid N $, that is $ \overline{N} = 0 $ in $ \Z / m_1 \dots m_n\Z $. This is just Corollary \ref{cor:10}. The statement about unit groups follows by noting that if $ R, S $ are rings, then $ \rb{R \times S}^* = R^* \times S^* $.
\end{proof}

\begin{note}
This can be reformulated more concretely as a statement about congruences. It says that for any $ a_i $, there is a unique $ x \mod m_1 \dots m_n $ such that $ x \equiv a_i \mod m_i $. The proof does not tell us how to find $ x $, but it is actually quite easy in practice. Here is one way to do it. Write $ M = m_1 \dots m_n $ and $ M_i = M / m_i $. Choose $ q_i $ such that $ q_iM_i \equiv 1 \mod m_i $, using Euclid's algorithm and $ \rb{M_i, m_i} = 1 $ because $ \rb{m_j, m_i} = 1 $ for all $ j \ne i $. Then set
$$ x = a_1q_1M_1 + \dots + a_nq_nM_n. $$
For each $ i $ we have $ M_j \equiv 0 \mod m_i $ if $ i \ne j $, so $ x \equiv a_iq_iM_i \equiv a_i \mod m_i $ for each $ i $.
\end{note}

\section{The structure of $ \rb{\Z / n\Z}^* $}

For the next few lecture we will study the abelian group $ \rb{\Z / n\Z}^* $.

\subsection{The Euler $ \Phi $ function}

We define a function $ \Phi\rb{n} $ on $ \Z_{> 0} $ by letting $ \Phi\rb{n} $ denote the order of $ \rb{\Z / n\Z}^* $. Explicitly we have $ \Phi\rb{n} = \#\cb{1 \le i < n \mid \rb{i, n} = 1} $, that is, $ \Phi\rb{n} $ is the number of integers between $ 0 $ and $ n - 1 $ coprime to $ n $.

\begin{example}
If $ p $ is prime, $ \Phi\rb{p} = p - 1 $.
\end{example}

$ \Phi $ is called \textbf{Euler's $ \Phi $ function}.

\begin{definition}
A function $ f $ on $ \Z_{> 0} $ is \textbf{multiplicative} if for all $ m, n \in \Z $ such that $ \rb{m, n} = 1 $, we have $ f\rb{mn} = f\rb{m}f\rb{n} $. We say $ f $ is \textbf{strongly multiplicative} if for any pair of $ m, n \in \Z_{> 0} $ we have $ f\rb{mn} = f\rb{m}f\rb{n} $.
\end{definition}

\begin{note}
By the Chinese Remainder Theorem, $ \Phi $ is multiplicative, because if $ \rb{m, n} = 1 $ then $ \rb{\Z / mn\Z}^* \cong \rb{\Z / m\Z}^* \times \rb{\Z / n\Z}^* $, but not strongly multiplicative, since $ \Phi\rb{4} = 2 \ne 1 = \Phi\rb{2}\Phi\rb{2} $.
\end{note}

It is clear that a multiplicative function is determined by its values on prime powers. For $ p $ prime we have $ \rb{i, p^a} = 1 $ if and only if $ p $ does not divide $ i $, so $ \Phi\rb{p^a} $ is the number of integers between $ 0 $ and $ p^a - 1 $ that are not divisible by $ p $. There are $ p^{a - 1} $ numbers in this range divisible by $ p $, so we have
$$ \Phi\rb{p^a} = \#\cb{1 \le i < p^a \mid \rb{i, p^a} = 1} = \#\cb{1 \le i < p^a \mid p \nmid i} = p^a - p^{a - 1} = p^a\rb{1 - \dfrac{1}{p}}. $$
Write $ n = \prod_i p_i^{a_i} $ where $ p_i $ are distinct primes. From this and multiplicativity of $ \Phi $ one has that
$$ \Phi\rb{n} = \prod_i \Phi\rb{p_i^{a_i}} = \prod_i p_i^{a_i}\rb{1 - \dfrac{1}{p_i}} = n\prod_i \rb{1 - \dfrac{1}{p_i}} = n\prod_{p \mid n} \rb{1 - \dfrac{1}{p}}, $$
where $ p $ runs over the primes dividing $ n $.

\subsection{Euler's theorem}

The units $ \rb{\Z / n\Z}^* $ form a group under multiplication. By definition, $ \phi\rb{n} $ is the order of this group. Recall that for any group $ G $ of finite order $ d $, Lagrange's theorem states that for all $ g \in G $, $ g^d $ is the identity in $ G $. For the group $ \rb{\Z / n\Z}^* $, this means the following.

\begin{theorem}[Euler's theorem]
\label{thm:16}
Let $ a \in \Z $ with $ \rb{a, n} = 1 $. Then $ a^{\Phi\rb{n}} \equiv 1 \mod n $.
\end{theorem}

\begin{proof}
This is equivalent to saying that $ \overline{a}^{\Phi\rb{n}} = 1 $ in $ \rb{\Z / n\Z}^* $. This is a group of order $ \Phi\rb{n} $, so this is immediate from Lagrange's theorem.
\end{proof}

\begin{corollary}[Fermat's little theorem]
If $ p $ is a prime and $ p \nmid a $ then $ a^{p - 1} \equiv 1 \mod p $.
\end{corollary}

\begin{proof}
Theorem \ref{thm:16} with $ n = p $, so $ \Phi\rb{n} = p - 1 $.
\end{proof}

Of course knowing the order of an abelian group does not tell you its structure.

\begin{example}
Let $ n = 5 $. $ \rb{\Z / 5\Z}^* = \cb{1, 2, 3, 4} $. This has order $ 4 $. There are two isomorphism classes of abelian groups of order $ 4 $, namely $ \Z / 4\Z $ and $ \Z / 2\Z \times \Z / 2\Z $. So it is either cyclic of order $ 4 $ or a product of two cyclic groups of order $ 2 $. $ 2^2 = 4 $, $ 2^3 = 3 $, $ 2^4 = 1 $ in $ \rb{\Z / 5\Z}^* $. So $ \rb{\Z / 5\Z}^* $ is cyclic of order $ 4 $.
\end{example}

By the Chinese Remainder Theorem, to understand the structure of $ \rb{\Z / n\Z}^* $, it is enough to understand the structure of $ \Z / p^m\Z $ where $ p $ is prime and $ m \ge 1 $. We will do this next, beginning with the case $ m = 1 $.

\marginpar{Lecture 4 \\ Friday \\ 12/10/18}

\begin{definition}
If $ G $ is a group and $ g \in G $ is an element, the \textbf{order} of $ g $ is the least $ a \ge 1 $ such that $ g^a = 1 $. In particular, if $ \rb{g, n} = 1 $, then we write $ ord_n\rb{g} $ for the order of $ g $ in $ \rb{\Z / n\Z}^* $, or the order of $ g $ modulo $ n $.
\end{definition}

Equivalently, let $ n \in \Z_{> 0} $ and $ g \in \Z $ with $ \rb{g, n} = 1 $, then the order of $ g $ modulo $ n $ is the smallest $ a \in \Z_{\ge 0} $ such that $ g^a \equiv 1 \mod n $.

\begin{proposition}
\label{prop:19}
If $ G $ is a group and $ g $ is an element of order $ a $, then $ g^n = 1 $ if and only if $ a \mid n $.
\end{proposition}

Equivalently, let $ g \in \Z $ with $ \rb{g, n} = 1 $, then if $ g^n \equiv \mod n $ then $ ord_n\rb{g} \mid n $.

\begin{proof}
If $ n = ab $ then $ g^n = \rb{g^a}^b = 1^b = 1 $. Conversely write $ n = ab + r $ with $ b, r \in \Z $ and $ 0 \le r < a $. Then since $ g^a = 1 $ it follows that $ g^r = 1 $. Since $ r < a $, $ r $ cannot be positive by the definition by order, so $ r = 0 $ and $ n = ab $.
\end{proof}

In particular, if $ \rb{g, n} = 1 $, then $ g^{\Phi\rb{n}} = 1 $ by Euler's theorem, so Proposition \ref{prop:19} gives the order of $ g $ modulo $ n $ divides $ \Phi\rb{n} $. We are going to prove that if $ p $ is prime, then $ \rb{\Z / p\Z}^* $ is cyclic. Equivalently, we need to show that there exists $ g $ such that $ ord_p\rb{g} = \Phi\rb{p} = p - 1 $. We will do this by counting the number of elements of each order. Key point is that $ \Z / p\Z $ is a field. For any $ d \ge 1 $, the elements of $ \rb{\Z / p\Z}^* $ of order dividing $ d $ are exactly the roots of the equation $ X^d - 1 $ in $ \Z / p\Z $ by Proposition \ref{prop:19}.

\begin{example}
The equation $ X^2 = 1 $ has exactly two solutions modulo $ p $ for any prime $ p $, namely $ \pm 1 $, but it can have more modulo $ n $ if $ n $ is composite. If $ n = 15 $, then $ 4, 11 $ are also solutions. $ X^2 - 1 \equiv 0 \mod n $ if and only if $ n \mid \rb{X + 1}\rb{X - 1} $, so $ 15 \mid \rb{4 + 1}\rb{4 - 1} $.
\end{example}

\begin{definition}
$ g \in \Z $ with $ \rb{g, p} = 1 $ is a \textbf{primitive root modulo $ p $} if the order of $ g $ modulo $ p $ is exactly $ p - 1 $, equivalently, if $ \overline{g} $ is a generator of $ \rb{\Z / p\Z}^* $.
\end{definition}

To prove that primitive roots exist, we require some results about roots of polynomials modulo $ p $. Over the rational numbers we all know that a polynomial of degree $ d $ has at most $ d $ roots. This can fail over other rings.

\begin{example}
The polynomial $ x^2 - x $ has the roots $ 0, 1, 3, 4 $ modulo $ 6 $. The issue here is that $ \Z / 6\Z $ is not a field.
\end{example}

\begin{lemma}
\label{lem:21}
Let $ R $ be a commutative ring, and let $ P\rb{X} $ be a polynomial in $ X $ with coefficients in $ R $. If $ \alpha \in R $ has $ P\rb{\alpha} = 0 $, then there exists a polynomial $ Q\rb{X} $ with coefficients in $ R $ such that $ P\rb{X} = \rb{X - \alpha}Q\rb{X} $.
\end{lemma}

\begin{example}
If $ R = \Z / 15\Z $, $ X^2 - 1 = \rb{X + 1}\rb{X - 1} = \rb{X + 4}\rb{X - 4} $.
\end{example}

\begin{proof}
We proceed by induction on the degree of $ P $, the degree zero case being clear. Suppose the result is true for polynomials of degree less than $ d - 1 $, and let $ P\rb{X} $ have degree $ d $. If the leading term of $ P\rb{X} $ is $ cX^d $, so $ P\rb{X} = cX^d + \dots $, let $ S\rb{X} = P\rb{X} - cX^{d - 1}\rb{X - \alpha} $. We have $ S\rb{\alpha} = 0 $, and $ S\rb{X} $ has degree less than $ d - 1 $. By induction, there exists $ R\rb{X} $ with coefficients in $ R $ such that we can write $ S\rb{X} = \rb{X - \alpha}R\rb{X} $. Set $ Q\rb{X} = cX^{d - 1} + R\rb{X} $. Then
$$ \rb{X - \alpha}Q\rb{X} = \rb{X - \alpha}\rb{cX^{d - 1} + R\rb{X}} = cX^{d - 1}\rb{X - \alpha} + S\rb{X} = P\rb{X}. $$
\end{proof}

\begin{theorem}
\label{thm:22}
Let $ F $ be a field, and $ P\rb{X} $ a polynomial of degree $ d $ with coefficients in $ F $. Then $ P\rb{X} $ has at most $ d $ distinct roots in $ F $.
\end{theorem}

\begin{proof}
We again proceed by induction on $ d = \deg\rb{P} $. The case $ d = 0 $ is clear. If $ P $ has no roots, then we are done. Otherwise, $ P\rb{X} $ has degree $ d $ and let $ \alpha $ be a root. By Lemma \ref{lem:21}, we can write $ P\rb{X} = \rb{X - \alpha}Q\rb{X} $. Now if $ P\rb{\beta} = 0 $, then $ \rb{\beta - \alpha}Q\rb{\beta} = 0 $, so since $ F $ is a field either $ \beta = \alpha $ or $ \beta $ is a root of $ Q\rb{X} $. By the inductive hypothesis $ Q\rb{X} $ has degree $ d - 1 $, so $ P $ has at most $ d $ roots and we are done by induction.
\end{proof}

As a corollary, we deduce the following.

\begin{corollary}
\label{cor:23}
Let $ p $ be a prime, and let $ d $ be any divisor of $ p - 1 $. Then there are exactly $ d $ elements of $ \rb{\Z / p\Z}^* $ of order dividing $ d $.
\end{corollary}

Equivalently, we have to show that the polynomial $ X^d - 1 $ has exactly $ d $ roots modulo $ p $.

\begin{proof}
Note that by Fermat's little theorem, $ 1, \dots, p - 1 $ are all roots of $ x^{p - 1} - 1 $ modulo $ p $. Thus $ X^{p - 1} - 1 $ has exactly $ p - 1 $ roots. Now fix $ d $ dividing $ p - 1 $ and write
$$ X^{p - 1} - 1 = \rb{X^d - 1}\rb{\rb{X^d}^{\tfrac{p - 1}{d} - 1} + \dots + 1} = \rb{X^d - 1}Q\rb{X}, \qquad \deg\rb{Q} = p - 1 - d, $$
for a polynomial $ Q\rb{X} $. $ Q\rb{X} $ has integer coefficients so we can view it as a polynomial modulo $ p $. Now $ X^{p - 1} - 1 $ has exactly $ p - 1 $ roots, $ X^d - 1 $ has at most $ d $ roots, and $ Q\rb{X} $ has at most $ p - 1 - d $ roots by Theorem \ref{thm:22}. We must therefore have equality in these inequalities, that is $ X^d - 1 $ has exactly $ d $ roots modulo $ p $.
\end{proof}

Another way of stating the corollary is to say that for any $ d $ dividing $ p - 1 $, there are exactly $ d $ elements of $ \rb{\Z / p\Z}^* $ whose order divides $ d $.

\begin{example}
Let $ p = 7 $. Then $ \rb{\Z / p\Z}^* $ has
\begin{enumerate}
\item $ 1 $ element of order $ 1 $,
\item $ 2 $ elements of order dividing $ 2 $, so $ 1 $ element of order $ 2 $,
\item $ 3 $ elements of order dividing $ 3 $, so $ 2 $ elements of order $ 3 $, and
\item $ 6 $ elements of order dividing $ 6 $, so $ 2 $ elements of order $ 6 $.
\end{enumerate}
\end{example}

\begin{lemma}
\label{lem:24}
For any $ n \ge 1 $, we have $ \sum_{d \mid n, \ d > 0} \Phi\rb{d} = n $.
\end{lemma}

\begin{proof}
For each $ d \mid n $, the elements $ i \in \cb{1, \dots, n} $ with $ \rb{i, n} = n / d $ are precisely those of the form $ i = \rb{n / d}j $ with $ 1 \le j \le d $ and $ \rb{j, d} = 1 $. There are exactly $ \Phi\rb{d} $ possibilities for $ j $, so there are exactly $ \Phi\rb{d} $ such elements. Summing over all $ d $, since the $ n / d $ run over all the divisors of $ n $, we are done with the result.
\end{proof}

\begin{theorem}
\label{thm:26}
Let $ p $ be a prime. Then for any $ d $ dividing $ p - 1 $, there are exactly $ \Phi\rb{d} $ elements of order $ d $ in $ \rb{\Z / p\Z}^* $. In particular there are $ \Phi\rb{p - 1} $ primitive roots modulo $ p $, and $ \rb{\Z / p\Z}^* $ is cyclic.
\end{theorem}

\begin{proof}
We prove this by strong induction on $ d $. The case $ d = 1 $ is clear. Fix $ d $. The inductive hypothesis tells us that for any $ d' $ dividing $ d $ and strictly less than $ d $ there are $ \Phi\rb{d'} $ elements of exact order $ d' $. On the other hand by Corollary \ref{cor:23} there are a total of $ d $ elements of $ \rb{\Z / p\Z}^* $ of order dividing $ d $. Thus the number of elements of $ \rb{\Z / p\Z}^* $ of order exactly $ d $ is
$$ \Phi\rb{d} = d - \sum_{d' \mid d, \ d' \ne d} \Phi\rb{d'}. $$
precisely by Lemma \ref{lem:24}. Now use inductive hypothesis.
\end{proof}

\marginpar{Lecture 5 \\ Tuesday \\ 16/10/18}

We can now go on to the case of $ \rb{\Z / p^n\Z}^* $ for $ n \ge 2 $. Firstly we do the case $ p > 2 $.

\begin{proposition}
\label{prop:26}
Let $ p $ be an odd prime and let $ n \ge 1 $. Then $ \rb{\Z / p^n\Z}^* $ is cyclic.
\end{proposition}

\begin{proof}
Consider three cases.
\begin{itemize}
\item[$ n = 1 $] Theorem \ref{thm:26}.
\item[$ n = 2 $] Let $ g $ be a primitive root modulo $ p $. Claim that either $ g^{p - 1} \not\equiv 1 \mod p^2 $, and $ g $ is a generator for $ \rb{\Z / p^2\Z}^* $, or $ g^{p - 1} \equiv 1 \mod p^2 $, and $ g + p $ is a generator for $ \rb{\Z / p^2\Z}^* $. Either way, $ \rb{\Z / p^2\Z}^* $ is cyclic. Suppose firstly that $ g^{p - 1} \not\equiv 1 \mod p^2 $. $ g^{ord_{p^2}\rb{g}} \equiv 1 \mod p^2 $ gives $ g^{ord_{p^2}\rb{g}} \equiv 1 \mod p $, so we have by assumption
$$ p - 1 = ord_p\rb{g} \mid ord_{p^2}\rb{g} \mid \#\rb{\Z / p^2\Z}^* = \Phi\rb{p^2} = p\rb{p - 1}. $$
But $ ord_{p^2}\rb{g} \ne p - 1 $, as $ g^{p - 1} \not\equiv 1 \mod p^2 $. So $ ord_{p^2}\rb{g} = p\rb{p - 1} $ as required. Now suppose that $ g^{p - 1} \equiv 1 \mod p^2 $, and set $ h = g + p $. It suffices to show that $ h^{p - 1} \not\equiv 1 \mod p^2 $, as we can then apply the analysis above with $ h $ in place of $ g $ to show that $ ord_{p^2}\rb{h} = p\rb{p - 1} $ and $ \rb{\Z / p^2\Z}^* $ is cyclic. To see the claim, observe that if we expand with the binomial theorem, then we get
$$ h^{p - 1} = \rb{g + p}^{p - 1} \equiv g^{p - 1} + \rb{p - 1}pg^{p - 2} \equiv 1 + p\rb{p - 1}g^{p - 2} \mod p^2, $$
and since $ p \nmid \rb{p - 1}g^{p - 2} $, $ \rb{g + p}^{p - 1} \not\equiv 1 \mod p^2 $, as required.
\item[$ n \ge 2 $] We claim that if $ ord_{p^2}\rb{g} = p\rb{p - 1} $ then in fact $ ord_{p^n}\rb{g} = p^{n - 1}\rb{p - 1} $ for all $ n \ge 2 $, so that in particular $ \rb{\Z / p^n\Z}^* $ is cyclic. We do this by induction on $ n $. So assume that $ ord_{p^n}\rb{g} = p^{n - 1}\rb{p - 1} $. Then
$$ p^{n - 1}\rb{p - 1} = ord_{p^n}\rb{g} \mid ord_{p^{n + 1}}\rb{g} \mid \Phi\rb{p^{n + 1}} = p^n\rb{p - 1}. $$
So either $ ord_{p^{n + 1}}\rb{g} = p^n\rb{p - 1} $, or $ ord_{p^{n + 1}}\rb{g} = p^{n - 1}\rb{p - 1} $. The statement that $ ord_{p^{n + 1}}\rb{g} = p^n\rb{p - 1} $ is equivalent to showing that $ g^{p^{n - 1}\rb{p - 1}} \not\equiv 1 \mod p^{n + 1} $. To do this, consider $ g^{p^{n - 2}\rb{p - 1}} \mod p^{n - 1} $ and $ g^{p^{n - 2}\rb{p - 1}} \mod p^n $. Since $ \Phi\rb{p^{n - 1}} = p^{n - 2}\rb{p - 1} $, $ g^{p^{n - 2}\rb{p - 1}} \equiv 1 \mod p^{n - 1} $ by Euler's theorem, so we may write
$$ g^{p^{n - 2}\rb{p - 1}} = 1 + p^{n - 1}t. $$
Since $ ord_{p^n}\rb{g} = p^{n - 1}\rb{p - 1} $ by assumption, $ g^{p^{n - 2}\rb{p - 1}} \not\equiv 1 \mod p^n $, that is $ p \nmid t $. Then the binomial theorem shows that
$$ g^{p^{n - 1}\rb{p - 1}} = \rb{g^{p^{n - 2}\rb{p - 1}}}^p = \rb{1 + p^{n - 1}t}^p \equiv 1 + p^nt + \two{p}{2}p^{2\rb{n - 1}}t^2 + \dots + p^{p\rb{n - 1}}t^p \mod p^{n + 1}, $$
Now $ r\rb{n - 1} \ge n + 1 $ if and only if $ \rb{r - 1}n \ge r + 1 $. Since $ p > 2 $,
$$ p \ \Big| \ \two{p}{2} \qquad \implies \qquad p^{n + 1} \ \Big| \ p^{2n - 1} = p^{2\rb{n - 1} + 1} \ \Big| \ \two{p}{2}p^{2\rb{n - 1}}. $$
So $ g^{p^{n - 1}\rb{p - 1}} \equiv 1 + p^nt \not\equiv 1 \mod p^{n + 1} $, because $ p \nmid t $. So the statement holds for $ n + 1 $, and we are done by induction
\end{itemize}
\end{proof}

\begin{note}
We used the hypothesis that $ p \ne 2 $ right at the end here. If $ p = 2 $ then we cannot ignore the higher order terms.
\end{note}

If $ n = 1, 2 $ then the proof of Proposition \ref{prop:26} did not use $ p > 2 $, and indeed
\begin{enumerate}
\item $ \rb{\Z / 2\Z}^* = \cb{1} $ is cyclic,
\item $ \rb{\Z / 4\Z}^* = \cb{1, 3} $ is cyclic of order $ 2 $, with $ 3 $ as a generator, but
\item this fails for higher powers, say $ \rb{\Z / 8\Z}^* = \cb{1, 3, 5, 7} $ is not cyclic since $ 1^2 \equiv 3^2 \equiv 5^2 \equiv 7^2 \equiv 1 \mod 8 $, so every element has order two.
\end{enumerate}
The key is the following lemma.

\begin{lemma}
\label{lem:27}
For $ n \ge 0 $ we have $ 5^{2^n} \equiv 1 + 2^{n + 2} \mod 2^{n + 3} $.
\end{lemma}

\begin{proof}
Induction on $ n $. The case $ n = 0 $ follows from $ 5 = 1 + 4 $. Suppose that $ 5^{2^n} = 1 + 2^{n + 2}t $ with $ t $ odd. Then
$$ 5^{2^{n + 1}} = \rb{1 + 2^{n + 1}t}^2 = 1 + 2^{n + 3}t + 2^{2\rb{n + 2}}t^2 = 1 + 2^{n + 3}\rb{t + 2^{n + 1}t^2}, $$
and since $ n + 1 \ge 1 $ and $ t + 2^{n + 1}t^2 $ is odd we are done by induction.
\end{proof}

\begin{proposition}
If $ n \ge 2 $ then we have an isomorphism $ \rb{\Z / 2^n\Z}^* \to \rb{\Z / 2\Z} \times \rb{\Z / 2^{n - 2}\Z} $, so that in particular if $ n \ge 3 $ then $ \rb{\Z / 2^n\Z}^* $ is not cyclic.
\end{proposition}

\begin{proof}
Consider the natural map
$$ \ab{-1} \times \ab{5} \to \rb{\Z / 2^n\Z}^*, $$
where if $ G $ is a group and $ g \in G $ we write $ \ab{g} $ for the cyclic subgroup $ \cb{1, \dots, g^{ord\rb{g} - 1}} $ of $ G $ generated by $ g $. We claim that this map is an isomorphism. To see this, note that it is injective, because if $ \rb{-1}^r\rb{5}^s \equiv 1 \mod 2^n $ then in particular $ \rb{-1}^r\rb{5}^s \equiv 1 \mod 4 $ so $ \rb{-1}^r \equiv 1 \mod 4 $, so we must have $ r = 1 $ and $ 5^s \equiv 1 \mod 2^n $, that is $ 5^s = 1 $ in $ \ab{5} $. $ \ab{-1} \cong \Z / 2\Z $ has order $ 2 $ and $ \ab{5} \cong \Z / 2^{n - 2}\Z $ has order $ ord_{2^n}\rb{5} = 2^{n - 2} $ by Lemma \ref{lem:27}. So $ \ab{-1} \times \ab{5} $ has order $ 2\rb{2^{n - 2}} = 2^{n - 1} = \Phi\rb{2^n} = \#\rb{\Z / 2^n\Z}^* $. So the map $ \ab{-1} \times \ab{5} \to \rb{\Z / 2^n\Z}^* $ is an injection of groups of the same order, so it is a bijection.
\end{proof}

Using what we have shown so far, one can conclude the following. See the first example sheet.

\begin{theorem}
Let $ n \in \Z_{> 0} $. The group $ \rb{\Z / n\Z}^* $ is cyclic if and only if either
\begin{enumerate}
\item $ n = 1, 2, 4 $,
\item $ n = p^r $ where $ p $ is an odd prime and $ r \ge 1 $, or
\item $ n = 2p^r $ where $ p $ is an odd prime and $ r \ge 1 $.
\end{enumerate}
\end{theorem}

\marginpar{Lecture 6 \\ Wednesday \\ 17/10/18}

Note that while the existence of primitive roots is very useful both theoretically and computationally, there is no simple procedure for finding them in practice, beyond trial and error by guessing small values of $ g $, and see if $ g $ is a generator. If $ p $ is prime then there are $ \Phi\rb{p - 1} $ primitive roots modulo $ p $, so they are plentiful, which means that you have a high probability of success, and so trying $ 2, 3, 5, 6, \dots $ is a reasonable strategy, but note that trying $ 4 $ would not be a good idea. We could work out $ 1, \dots, g^{p - 2} $ and check these are distinct, but this would be inefficient. Better is to check that if $ q $ is any prime factor of $ p - 1 $, then $ g^{\rb{p - 1} / q} \ne 1 $. This works, because if $ g $ is not a primitive root, then the order of $ g $ modulo $ p $ is a proper factor of $ p - 1 $, so divides some $ \rb{p - 1} / q $, so $ g^{\rb{p - 1} / q} = 1 $, while if $ g^{\rb{p - 1} / q} \ne 1 $ then $ ord_p\rb{g} \mid \rb{p - 1} $ and $ ord_p\rb{g} \nmid \rb{p - 1} / q $. If this holds for all $ q \mid \rb{p - 1} $, then $ ord_p\rb{g} = p - 1 $, because otherwise it would be a proper divisor, and so would divide $ \rb{p - 1} / q $ for some prime $ q \mid \rb{p - 1} $.

\begin{note}
This does rely on being able to factor $ p - 1 $, which is a hard problem in general. See the next section.
\end{note}

The work of computing powers of $ a^k $ modulo $ p $ can be done efficiently by repeated squaring followed by multiplication according to the binary expansion of $ k $.

\begin{example}
Let us find a primitive root modulo $ p = 31 $. $ p - 1 = 30 = \rb{2}\rb{3}\rb{5} $. $ g $ is a primitive root if and only if $ g^{15} \ne 1 $, $ g^{10} \ne 1 $, $ g^{6} \ne 1 $. It is easy to see that $ 2 $ does not work because $ 2^2 = 4 $, $ 2^4 = 16 $, $ 2^6 = 2 $, but $ 2^10 = 2^15 = 1 $ because $ 2^5 = 32 = 1 $, so $ 2 $ is not a primitive root. We claim that $ 3 $ is a primitive root. We need to show that none of $ 3^6 $, $ 3^{10} $, $ 3^{15} $ are $ 1 $.
$$ 3^2 = 9, \quad 3^4 = -12, \quad 3^8 = 20 \quad \implies \quad 3^6 = 9\rb{-12} = 16, \quad 3^{10} = 9\rb{20} = 25, \quad 3^{15} = 3\rb{25}\rb{-12} = -1. $$
So $ 3 $ is a primitive root modulo $ 31 $, as required.
\end{example}

\section{Primality testing and factorisation}

Idea is testing whether $ n \in \Z $ is prime is easy. Factoring $ n $ is expected to be hard. Easy here means that there is an algorithm to check whether $ n $ is prime or not which runs in time polynomial in $ \log n $. It is known that a deterministic algorithm exists to do this, the Agrawal-Kayal-Saxena (AKS) algorithm in 2005. We will see an algorithm that runs faster than this in practice. On the other hand, for factoring there are algorithms which are better than exponential in $ \log n $, but there is nothing close to polynomial time, and the general expectation is that no such algorithm should exist.

\subsection{Factorisation}

How do we factor three digit numbers, or small four digit numbers, say $ n \le 400 $, if we wanted to factor with paper or calculator? If $ n \le 400 $ and $ n $ is composite, then $ n $ has a prime factor $ d \le \sqrt{400} = 20 $. If $ d \mid n $ then $ d\rb{n / d} = n $, so either $ d \le \sqrt{n} $ or $ n / d \le \sqrt{n} $. So you only have to be able to check for divisibility $ 2, 3, 5, 7, 11, 13, 17, 19 $.
\begin{enumerate}
\item Checking by divisibility by $ 2 $ or $ 5 $ is easy. Just look at the last digit.
\item For $ 3 $, $ 11 $, use that $ 10 \equiv 1 \mod 3 $ and $ 10 \equiv -1 \mod 3 $. So
$$ \sum_{i = 0}^{\log n} a_i10^i \equiv \sum_{i = 0}^{\log n} a_i \mod 3, \qquad \sum_{i = 0}^{\log n} a_i10^i \equiv \sum_{i = 0}^{\log n} a_i\rb{-1}^i \mod 11. $$
So you can check divisibility by $ 3 $ or $ 9 $ by checking for the sum of the digits, and $ 11 $ by taking the alternating sum.
\item For $ 7 $, $ 10x + y \equiv 0 \mod 7 $ if and only if $ -2\rb{10x + y} \equiv 0 \mod 7 $, if and only if $ x - 2y \equiv 0 \mod 7 $.
\item For $ 13 $, $ 17 $, $ 19 $, there are no good tests. If $ n \le 400 $ and $ n $ is not divisible by $ 2, 3, 5, 7, 11 $, then the smallest prime factor of $ n $ is at least $ 13 $. Since $ 13^3 > 400 $, it can have at most $ 2 $ prime factors. So if you want to factor numbers $ \le 400 $, you only have to remember a short list
$$ 13^2, \qquad 13\rb{17}, \qquad 13\rb{19}, \qquad 13\rb{23}, \qquad 13\rb{29}, \qquad 17^2, \qquad 17\rb{19}, \qquad 17\rb{23}, \qquad 19^2. $$
\end{enumerate}

\begin{example}
$ 143 \equiv 1 - 4 + 3 \equiv 0 \mod 11 $, $ 144 \equiv 1 + 4 + 4 \equiv 0 \mod 9 $, and $ 154 \equiv 15 - 2\rb{4} = 7 \equiv 0 \mod 7 $.
\end{example}

\marginpar{Lecture 7 \\ Friday \\ 19/10/18}

Factor four digit numbers by an algorithm due to Fermat. Idea is to first check for small prime factors by hand, say $ p = 2, \dots 19 $. If $ n $ is composite and does not have any small factors, then the prime factors of $ n $ should be close to $ \sqrt{n} $. If $ n = ab $ for $ a, b $ odd and $ a \le b $, then
$$ n = ab = \rb{\dfrac{a + b}{2}}^2 - \rb{\dfrac{b - a}{2}}^2, \qquad \rb{\dfrac{a + b}{2}}^2 - n = \rb{\dfrac{b - a}{2}}^2. $$
If you know $ \rb{a + b} / 2 $ and $ \rb{b - a} / 2 $, you can recover $ a, b $. So take $ m $ such that $ m^2 \le n < \rb{m + 1}^2 $. If $ n = m^2 $, done, otherwise check if $ \rb{m + i}^2 - n $ is a square for increasing $ i $.

\begin{example}
Let $ n  = 6077 $. $ 77^2 < 6077 < 78^2 $, so
\begin{align*}
78^2 - 6077 & = 7, \\
79^2 - 6077 & = 164, \\
80^2 - 6077 & = 323, \\
81^2 - 6077 & = 484 = 22^2.
\end{align*}
Thus $ 6077 = 81^2 - 22^2 = \rb{103}\rb{59} $.
\end{example}

There exist algorithms for factoring $ n $ which run in better than exponential time in $ \log n $, such as the quadratic sieve and the general number field sieve. The following is the \textbf{quadratic sieve}.

\begin{example}
Let $ n = 1649 $. $ 40^2 < 1649 < 41^2 $, so
\begin{align*}
41^2 - 1649 & = 32 = 2^5, \\
42^2 - 1649 & = 115, \\
43^2 - 1649 & = 200 = \rb{2}^3\rb{5}^2.
\end{align*}
$ 41^2 \equiv 2^5 \mod 1649 $ and $ 43^2 \equiv \rb{2}^3\rb{5}^2 \mod 1649 $, so $ 80^2 \equiv \rb{41}^2\rb{43}^2 = 1763^2 \equiv 114^2 \mod 1649 $. Then $ 0 \equiv 114^2 - 80^2 = \rb{194}\rb{34} = \rb{2}^2\rb{17}\rb{97} \mod 1649 $. In fact, $ 1649 = \rb{17}\rb{97} $. Better for this last step would be to have computed $ \rb{194, 1649} = 97 $ and $ \rb{34, 1649} = 17 $. Can do this quickly using Euclid's algorithm.
\end{example}

To make this into an efficient algorithm, need to have a way given $ x_1, \dots, x_r $ to find a subset whose product is a square. If we know the prime factorisation for the $ x_i $, we can write $ x_i = p_1^{a_{i1}} \dots p_k^{a_{ik}} $. Want to choose $ \epsilon_i \in \cb{0, 1} $ such that $ \prod_{i = 1}^r x_i^{\epsilon_i} $ is a square. Equivalently, for each $ j $, want the exponent of $ p_j $ to be even, that is $ \sum_{i = 1}^r \epsilon_ia_{ij} \equiv 0 \mod 2 $.

\begin{example}
$ x_1 = 2^5 $, $ x_2 = \rb{5}\rb{23} $, $ x_3 = \rb{2}^3\rb{5}^2 $. $ p_1 = 2 $, $ p_2 = 5 $, $ p_3 = 23 $. Ignore all numbers with a large prime factor, here ignore $ 23 $. Left with $ x_1 = 2^5 $ and $ x_3 = \rb{2}^3\rb{5}^2 $.
$$ \begin{pmatrix} \epsilon_1 & \epsilon_2 \end{pmatrix} \two{5 & 0}{3 & 2} \equiv \begin{pmatrix} 0 & 0 \end{pmatrix} \mod 2 \qquad \iff \qquad \begin{pmatrix} \epsilon_1 & \epsilon_2 \end{pmatrix} \two{1 & 0}{1 & 0} = \begin{pmatrix} 0 & 0 \end{pmatrix} $$
in the field $ \Z / 2\Z = \F_2 $, that is $ \epsilon_1 + \epsilon_2 = 0 $, so choose $ \epsilon_1 = \epsilon_2 = 1 $.
\end{example}

This step, solving linear equations in $ \Z / 2\Z $, can be done efficiently. The remaining difficulty is to find a supply of $ m \in \Z $ such that $ m^2 - n $ has only small prime factors. Idea is if we fix a list of small primes to start with, we get congruence conditions on $ m $. It turns out that there is a straightforward algorithm for solving $ m^2 \equiv n \mod p $. This gives two possible values for $ m $ modulo $ p $. If you do this for lots of primes $ p $, you get a supply of congruence conditions for $ m $, so you can eliminate ever considering $ m $ such that $ m^2 - n $ has large prime factors.

\begin{example}
$ m^2 = 1649 \equiv 2 \mod 3 $ has no solutions.
\end{example}

\marginpar{Lecture 8 \\ Tuesday \\ 23/10/18}

\subsection{Primality testing}

Euler's theorem states that if $ \rb{a, n} = 1 $ then $ a^{\Phi\rb{n}} \equiv 1 \mod n $. In particular if $ p $ is prime then $ a^{p - 1} $ then $ a^{p - 1} \equiv 1 \mod p $ for all $ 1 \le a \le p - 1 $. In particular if $ 2^{n - 1} \equiv 1 \mod n $, then $ n $ cannot be prime. Problem is that there exists $ n $ composite such that $ a^{n - 1} \equiv 1 \mod n $ for all $ \rb{a, n} = 1 $. These numbers are called \textbf{Carmichael numbers}. It is known that infinitely many of these exist. Miller-Rabin test is a test for whether $ n \in \Z $ is prime or not. Today let $ n \equiv 3 \mod 4 $. Example sheet is $ n \equiv 1 \mod 4 $.

\begin{lemma}
\label{lem:30}
Let $ n > 1 $ be congruent to $ 3 $ modulo $ 4 $. Then $ n $ is prime if and only if for all $ \rb{a, n} = 1 $, $ a^{\rb{n - 1} / 2} \equiv \pm 1 \mod n $.
\end{lemma}

\begin{proof}
If $ n $ is prime, then $ a^{n - 1} \equiv 1 \mod n $ by Fermat's Little theorem, so $ \rb{a^{\rb{n - 1} / 2}}^2 \equiv 1 \mod n $, so $ a^{\rb{n - 1} / 2} \equiv \pm 1 \mod n $. Suppose firstly that $ n = p^k $ with $ p $ prime, and $ k \ge 2 $. Try $ a = 1 + p $. Then $ \rb{1 + p}^{\rb{n - 1} / 2} \equiv 1 + \rb{\rb{n - 1} / 2}p \mod p^2 $, by the binomial theorem. If $ \rb{1 + p}^{\rb{n - 1} / 2} \equiv \pm 1 \mod p^k = n $, then $ \rb{1 + p}^{\rb{n - 1} / 2} \equiv \pm 1 \mod p, p^2 $ gives
$$ \pm 1 \equiv \rb{1 + p}^{\tfrac{n - 1}{2}} \equiv 1 + \rb{\dfrac{n - 1}{2}}p \equiv 1 \mod p \qquad \implies \qquad 1 \equiv \rb{1 + p}^{\tfrac{n - 1}{2}} \equiv 1 + \rb{\dfrac{n - 1}{2}}p \mod p^2, $$
then $ p \mid \rb{\rb{n - 1} / 2} $, so $ p \mid \rb{n - 1} $. But $ p \mid n $, a contradiction. The remaining case is that $ n $ is composite but not a power of a prime. Write $ n = rs $, for $ r, s > 1  $ and odd, and $ \rb{r, s} = 1 $. By the Chinese remainder theorem, $ \Z / n\Z \cong \Z / r\Z \times \Z / s\Z $. Choose $ a $ such that $ a \equiv -1 \mod r $ and $ a \equiv 1 \mod s $. Then $ \rb{a, r} = \rb{a, s} = 1 $, so $ \rb{a, n} = 1 $. Since $ n \equiv 3 \mod 4 $, $ \rb{n - 1} / 2 $ is odd, so $ a^{\rb{n - 1} / 2} \equiv -1 \mod r $ and $ a^{\rb{n - 1} / 2} \equiv 1 \mod s $. So $ a^{\rb{n - 1} / 2} \not\equiv \pm 1 \mod n $.
\end{proof}

\begin{lemma}
\label{lem:31}
Suppose that $ n \equiv 3 \mod 4 $ is composite. Then the set of $ a \in \rb{\Z / n\Z}^* $ which satisfy $ a^{\rb{n - 1} / 2} \equiv \pm 1 \mod n $ is a proper subgroup of $ \rb{\Z / n\Z}^* $.
\end{lemma}

\begin{proof}
Certainly $ 1^{\rb{n - 1} / 2} \equiv 1 \mod n $. If $ a^{\rb{n - 1} / 2} \equiv \pm 1 \mod n $ and $ b^{\rb{n - 1} / 2} \equiv \pm 1 \mod n $,
$$ \rb{ab}^{\rb{n - 1} / 2} \equiv a^{\rb{n - 1} / 2}b^{\rb{n - 1} / 2} \equiv \rb{\pm 1}\rb{\pm 1} \equiv \pm 1, \quad \rb{a^{-1}}^{\rb{n - 1} / 2} \equiv \rb{a^{\rb{n - 1} / 2}}^{-1} \equiv \rb{\pm 1}^{-1} \equiv \pm 1 \mod n. $$
So this set is a subgroup of $ \rb{\Z / n\Z}^* $. It is a proper subgroup by Lemma \ref{lem:30}.
\end{proof}

\begin{corollary}
At most half the elements of $ \rb{\Z / n\Z}^* $ satisfy $ a^{\rb{n - 1} / 2} \equiv \pm 1 \mod n $.
\end{corollary}

\begin{proof}
The set of such elements is a proper subgroup of $ \rb{\Z / n\Z}^* $ by Lemma \ref{lem:31}.
\end{proof}

In fact, with a bit more work, you can improve this to show that at least $ 3 / 4 $ of the numbers $ 1 \le a \le n - 1 $ satisfy $ a^{\rb{n - 1} / 2} \not\equiv \pm 1 \mod n $. So if you randomly choose numbers $ 1 \le a \le n - 1 $ $ x $ times, and $ n $ is composite, the probability that you find some $ a $ with $ a^{\rb{n - 1} / 2} \not\equiv \pm 1 \mod n $ is at least $ 1 - \rb{1 / 4}^x $. This gives a probabilistic algorithm to check if $ n $ is prime in polynomial time. If you assume generalised Riemann hypothesis (GRH) you can find some $ a \in \Z $ with
$$ 1 \le a \le \left\lceil 2 \rb{\log n}^2 \right\rceil, \qquad a^{\rb{n - 1} / 2} \not\equiv \pm 1 \mod n. $$
In practice it is even better.

\begin{example}
If $ n < 341550071728321 $, then one of $ a = 2, 3, 5, 7, 11, 13, 17 $ will work.
\end{example}

\section{Public key cryptography}

How do we turn messages into numbers in $ \Z / n\Z $? Idea is to choose $ n $ very large. Say $ n > 2^{8k} $. Write down your message. Break it up into strings of at most $ k $ characters. Encode each character as an $ 8 $ bit binary number. String these integers together to get an $ 8k $ bit binary number. Regard that as an integer modulo $ n $. Now apply some function $ f : \Z / n\Z \to \Z / n\Z $, and then tell whoever you are trying to communicate with the result of this computation. Then they should apply some other function $ g : \Z / m\Z \to \Z / n\Z $, to get back the number you started with. So want $ f $ to be injective. Want to be able to make $ f $ public without making $ g $ public. If you have functions $ f, g : \Z / n\Z \to \Z / n\Z $ with $ f \circ g = g \circ f = id $, then you can also verify your identity, that is sign messages. Again, make $ f $ public, and any time you publish a message $ m $, you also publish $ g\rb{m} $. Then anyone can apply $ f $ to $ g\rb{m} $ to recover $ m = f\rb{g\rb{m}} $, but without $ g $, no one can forge your signature.

\subsection{Rivest-Shamir-Adleman (RSA) algorithm}

Idea is to choose two large prime numbers $ p, q $ and set $ n = pq $. Choose $ \rb{e, \Phi\rb{n}} = 1 $. Find $ d $ such that $ de = 1 \mod \Phi\rb{n} = \rb{p - 1}\rb{q - 1} = n - \rb{p + q} + 1 $. Publish $ n $ and $ e $, you keep $ p, q, \Phi\rb{n}, d $ secret. $ f\rb{x} = x^e \mod n $ and $ g\rb{x} = x^d \mod n $. $ x^{de} \equiv x^1 \equiv x \mod n $ because $ de \equiv 1 \mod \Phi\rb{n} $ and $ x^{\Phi\rb{n}} \equiv 1 \mod n $.

\marginpar{Lecture 9 \\ Wednesday \\ 24/10/18}

Lecture 9 is a problem class.

\marginpar{Lecture 10 \\ Friday \\ 26/10/18}

So if someone wants to send you a message $ c \in \Z / n\Z $, they compute $ c^e \in \Z / n\Z $, and send it to you. To decode it, you compute $ \rb{c^e}^d = c^{de} \equiv c \mod n $. This assumes that $ \rb{c, n} = 1 $, but the probability of this is extremely high. The prevailing assumption is that with only the information $ n $ and $ e $, it is hopeless to discover $ d $, or to find any other way of recovering $ c $ from $ c^e $.

\subsection{Discrete logarithms}

Suppose that $ n $ is prime, or more generally that $ \rb{\Z / n\Z}^* $ is cyclic. Let $ g $ be a generator for this group, that is a primitive root. For any $ a \in \rb{\Z / n\Z}^* $, we can write $ a = g^m $ for some unique $ 0 \le m < \Phi\rb{n} $. We call $ m $ the \textbf{discrete logarithm} of $ a $ to base $ g $, write $ m = \log_g\rb{a} $.

\begin{example}
If you want to solve $ x^r \equiv a \mod n $, write $ x = g^y $, and the congruence becomes equivalent to $ yr \equiv \log_g\rb{a} \mod \Phi\rb{n} $.
\end{example}

Unfortunately, or fortunately for cryptography, computing $ \log_g $ is believed to be a hard problem. In particular, there is no known polynomial time algorithm.

\begin{example}
Imagine that you have a system where you need to store passwords for different users, but you do not want to store the actual passwords. One way to do this is to choose a large prime $ p $ and a primitive root $ g $, and if someone inputs $ x $ as their password, you store $ g^x $ modulo $ p $. If they later input $ y $, you compute $ g^y $, and check it matches what you stored. If it does then $ y \equiv x \mod p - 1 $.
\end{example}

\section{Quadratic residues and quadratic reciprocity}

Let $ p $ be a prime number.

\begin{definition}
If $ \rb{a, p} = 1 $, then $ a $ is a \textbf{quadratic residue} (QR) if and only if there is a solution to $ x^2 \equiv a \mod p $. If $ \rb{a, p} = 1 $ and is not a QR, it is called a \textbf{quadratic nonresidue} (QNR).
\end{definition}

\begin{example}
If $ p = 2 $, $ 1 $ is a QR. If $ p = 3 $, $ 1 $ is a QR, $ -1 $ is a QNR, since $ 1^2 \equiv \rb{-1}^2 \equiv 1 \mod 3 $. If $ p = 5 $, $ 1, 4 $ are QRs, $ 2, 3 $ are QNRs, since $ 1^2 \equiv \rb{-1}^2 \equiv 1 \mod 5 $ and $ 2^2 \equiv 3^2 \equiv 4 \mod 5 $.
\end{example}

\begin{lemma}
\label{lem:34}
If $ p > 2 $ then there are exactly $ \rb{p - 1} / 2 $ QRs, and $ \rb{p - 1} / 2 $ QNRs modulo $ p $.
\end{lemma}

\begin{proof}
The map $ \rb{\Z / p\Z}^* \to \rb{\Z / p\Z}^* $ by $ x \mapsto x^2 $ is a group homomorphism with kernel is $ \cb{\pm 1} $. So the image has order $ \rb{p - 1} / 2 $, and the image is exactly the QRs.
\end{proof}

\begin{proposition}
\label{prop:35}
Suppose that $ \rb{a, p} = \rb{b, p} = 1 $. Then
\begin{enumerate}
\item if $ a, b $ are both QRs, then $ ab $ is a QR,
\item if one of $ a, b $ is a QR and one is a QNR, then $ ab $ is a QNR, and
\item if $ a, b $ are both QNRs, then $ ab $ is a QR.
\end{enumerate}
\end{proposition}

\begin{proof}
Let $ H $ be the image of $ \rb{\Z / p\Z}^* \to \rb{\Z / p\Z}^* $ by $ x \mapsto x^2 $, that is $ H $ is the QRs. Then $ \rb{\Z / p\Z}^* / H $ is a group of order two by Lemma \ref{lem:34}, so it is cyclic of order two. This statement is a restatement of the proposition, since $ \rb{\Z / p\Z}^* = H \sqcup 1 + H $.
\end{proof}

\begin{definition}
Let $ a $ be an integer and $ p $ a prime. Then
$$ \legendre{a}{p} = \begin{cases} 1 & a \text{ is a QR modulo } p \\ 0 & p \mid a \\ -1 & a \text{ is a QNR modulo } p \end{cases}. $$
\end{definition}

Proposition \ref{prop:35} can be restated as saying that $ \rb{\Z / p\Z}^* \to \cb{\pm 1} $ by $ a \mapsto \legendre{a}{p} $ is a group homomorphism, that is $ \legendre{ab}{p} = \legendre{a}{p}\legendre{a}{p} $. Even holds if we do not assume that $ \rb{a, p} = \rb{b, p} = 1 $.

\marginpar{Lecture 11 \\ Tuesday \\ 30/10/18}

\begin{theorem}[Euler's criterion]
If $ p $ is an odd prime, and $ p \nmid a $, then $ \legendre{a}{p} \equiv a^{\rb{p - 1} / 2} \mod p $.
\end{theorem}

\begin{proof}
Let $ g $ be a primitive root modulo $ p $, and write $ a \equiv g^r \mod p $ for $ 0 \le r < p - 1 $. Now $ \rb{g^{\rb{p - 1} / 2}}^2 = g^{p - 1} \equiv 1 \mod p $. So $ g^{\rb{p - 1} / 2} \equiv \pm 1 \mod p $. Since $ g $ is a primitive root, $ g^{\rb{p - 1} / 2} \not\equiv 1 \mod p $, so $ g^{\rb{p - 1} / 2} \equiv -1 \mod p $. So $ a^{\rb{p - 1} / 2} \equiv \rb{g^r}^{\rb{p - 1} / 2} \equiv \rb{g^{\rb{p - 1} / 2}}^r = \rb{-1}^2 \mod p $. But
\begin{align*}
\legendre{a}{p} = 1 \qquad
& \iff \qquad \exists s \in \Z, \ \rb{g^s}^2 \equiv a \mod p \\
& \iff \qquad 2s \equiv r \mod p - 1 \\
& \iff \qquad \exists n \in \Z, \ r = 2n \\
& \iff \qquad \rb{-1}^r \equiv 1 \mod p.
\end{align*}
\end{proof}

\begin{proposition}
$ -1 $ is a square modulo $ p $ if and only if $ p = 2 $ or $ p \equiv 1 \mod 4 $.
\end{proposition}

\begin{proof}
$ p = 2 $ is trivial. If $ p > 2 $, then by Euler's criterion, $ \legendre{-1}{p} \equiv \rb{-1}^{\rb{p - 1} / 2} \mod p $, so in fact $ \legendre{-1}{p} = \rb{-1}^{\rb{p - 1} / 2} $. Then
$$ \rb{-1}^{\tfrac{p - 1}{2}} = \begin{cases} 1 & p \equiv 1 \mod 4 \\ -1 & p \equiv 3 \mod 4 \end{cases}. $$
\end{proof}

\begin{proposition}
$$ \legendre{2}{p} = \begin{cases}  1 & p \equiv \pm 1 \mod 8 \\ -1 & p \equiv \pm 3 \mod 8 \end{cases}, $$
that is $ \legendre{2}{p} = \rb{-1}^{\rb{p^2 - 1} / 8} $.
\end{proposition}

\begin{example}
$ \legendre{2}{7} = 1 $ since $ 2 \equiv 3^3 \mod 7 $. $ \legendre{2}{11} = -1 $ since squares modulo $ 11 $ are $ 1, 4, 9, 5, 3 $. $ \legendre{-1}{11} = -1 $, so $ \legendre{-2}{11} = \legendre{2}{11}\legendre{-1}{11} = \rb{-1}^2 = 1 $ and $ -2 \equiv 3^2 \mod 11 $.
\end{example}

\begin{proof}
$ \legendre{2}{p} \equiv 2^{\rb{p - 1} / 2} \mod p $ by Euler's criterion. Let $ q = \rb{p - 1} / 2 $, and let $ Q = \rb{2}\rb{4} \dots \rb{p - 3}\rb{p - 1} = \rb{\rb{2}\rb{1}}\rb{\rb{2}\rb{2}} \dots \rb{\rb{2}\rb{q - 1}}\rb{\rb{2}\rb{q}} $. So $ Q = 2^qq! = 2^{\rb{p - 1} / 2}q! $. Subtracting $ p $ from every term which is bigger than $ q $, $ Q \equiv \rb{2}\rb{4} \dots \rb{-3}\rb{-1} \equiv \rb{-1}^rq! \mod p $, where $ r $ is the number of odd integers in $ 1, \dots, q $. Since $ p \nmid q! $, we have $ 2^{\rb{p - 1} / 2} \equiv \rb{-1}^r \mod p $. Now it is an exercise to check that
$$ \rb{-1}^r = \begin{cases} 1 & p \equiv \pm 1 \mod 8 \\ -1 & p \equiv \pm 3 \mod 8 \end{cases}. $$
\end{proof}

\begin{example}
If $ p \equiv 1 \mod 8 $, say $ p = 1 + 8n $, so $ q = 4n $. Odd integers in $ 1, \dots, 4n $ are $ 1, \dots, 4n - 1 $, so $ r = 2n $.
\end{example}

\begin{theorem}[Law of quadratic reciprocity]
If $ p, q $ are odd primes, then
$$ \legendre{p}{q} = \legendre{q}{p}\rb{-1}^{\rb{\tfrac{p - 1}{2}}\rb{\tfrac{q - 1}{2}}}, $$
that is $ \legendre{p}{q} = \legendre{q}{p} $ unless $ p \equiv q \equiv 3 \mod 4 $, when $ \legendre{p}{q} = -\legendre{q}{p} $.
\end{theorem}

\begin{example}
$ \legendre{5}{p} = \legendre{p}{5} $ for $ p \ne 5 $. QRs modulo $ 5 $ are $ 1, 4 $. So
$$ \legendre{5}{p} = \begin{cases} 1 & p \equiv \pm 1 \mod 5 \\ -1 & p \equiv \pm 2 \mod 5 \end{cases}. $$
What is $ \legendre{3}{p} $ for $ p \ne 3 $? If $ p \equiv 1 \mod 4 $, then
$$ \legendre{3}{p} = \legendre{p}{3} = \begin{cases} 1 & p \equiv 1 \mod 3 \\ -1 & p \equiv -1 \mod 3 \end{cases}. $$
If $ p \equiv -1 \mod 4 $, then
$$ \legendre{3}{p} = -\legendre{p}{3} = \begin{cases} 1 & p \equiv -1 \mod 3 \\ -1 & p \equiv 1 \mod 3 \end{cases}. $$
So
$$ \legendre{3}{p} = \begin{cases} 1 & p \equiv \pm 1 \mod 12 \\ -1 & p \equiv \pm 5 \mod 12 \end{cases}. $$
If $ p = 7 $, QRs are $ 1, 2, 4 $, so $ \legendre{3}{p} = -1 $. If $ p = 11 $, $ 5^2 \equiv 3 \mod 11 $, so $ \legendre{3}{p} = 1 $.
\end{example}

\begin{example}
$ \legendre{6}{19} = \legendre{2}{19}\legendre{3}{19} = \rb{-1}\rb{-1} = 1 $. $ \legendre{2}{19} = -1 $ because $ 19 \equiv 3 \mod 8 $. $ \legendre{3}{19} \equiv -1 \mod 12 $ by the above.
\end{example}

In general to compute $ \legendre{a}{p} $, we could do the following. Use that if $ a \equiv b \mod p $ then $ \legendre{a}{p} = \legendre{b}{p} $. So without loss of generality $ \abs{a} < p $. Then write $ a = \pm \prod_i q_i^{s_i} $ for $ q_i $ prime. Then $ \legendre{a}{p} = \legendre{\pm 1}{p} \prod_i \legendre{q_i}{p}^{s_i} $. If $ s_i $ is even, then $ \legendre{q_i}{p}^{s_i} = 1 $. If $ s_i $ is odd, then $ \legendre{q_i}{p}^{s_i} = \legendre{q_i}{p} $. We have formulas for $ \legendre{-1}{p} $ and $ \legendre{2}{p} $. If $ q $ is an odd prime, $ q < p $, then use quadratic reciprocity to relate $ \legendre{q}{p} $ and $ \legendre{p}{q} $. Then repeat modulo $ q $.

\end{document}